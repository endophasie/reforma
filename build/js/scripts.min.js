function shuffle(e){for(var a,s,o=e.length;0!==o;)s=Math.floor(Math.random()*o),o-=1,a=e[o],e[o]=e[s],e[s]=a;return e}var data={deck:[{id:"101",type:"economics",title:"Подушная подать",content:"Обложить налогом мужчин всех сословий, кроме дворянства и духовенства",failMessage:!1},{id:"102",type:"economics",title:"Подворная подать",content:"Собирать налог не с отдельных представителей податных сословий, а с семьи как хозяйствующего субъекта",failMessage:!1},{id:"103",type:"economics",title:"Пропорциональный подоходный налог",content:"Обложить налогом представителей всех сословий без исключения пропорционально их доходам: чем больше доход, тем выше налог",failMessage:{title:"Конфуз вышел, государь!",content:"Все известные попытки введения пропорционального подоходного налога в условиях сословного общества закончились плачевно. В России они, по счастью, вообще не предпринимались вплоть до Первой мировой войны. Что же касается времен Петра I, служилое сословие по традиции рассматривалось как выплачивающее «налог кровью». Церковь, с некоторыми нюансами, была свободна от налогов еще с татаро-монгольских времен. Возложить дополнительное налоговое бремя на богатых купцов означало удушить оживляющуюся внешнюю торговлю и формирующуюся национальную промышленность. Иными словами, введение подоходного налога – слишком решительный шаг в условиях первой четверти XVIII века, который мог закончиться, чем угодно: бунтом, дворянским заговором, но только не победой в Северной войне."}}],messages:{contras:[{id:"101102103",content:"Пополнять казну, конечно, можно разными способами, но налоговая система должна базироваться на какой-то одной подати."}],cardactivated:[{id:"1",cardId:"303",comment:"Заработала В3",content:"Теперь у нас есть и рекруты, годные к воинской службе, и устав, согласно которому эти рекруты будут служить, и офицеры, способные обучить новобранцев военному делу и руководить ими в бою. Наша армия определенно обрела плоть."}],finalWin:[{id:"1",comment:"Вводное слово",title:"Виктория, государь!",content:"Швед разбит, Россия прочно закрепилась на Балтике, прорублено окно в Европу. Наше вымуштрованное войско, вооруженное по последнему слову военной техники и снабженное всем необходимым, отныне является одним из сильнейших в Европе и мире."}],finalFail:[{id:"1",comment:"Вводное слово",title:"Конфуз вышел, государь!",content:"Как разбить шведа, когда "}]}},Reforma=function(){var e=this,a=data.deck,s=0,o=2,i=[],r=[],t="";e.init=function(){e.reset(),m()},e.reset=function(){console.log("reset",1),s=0,o=2,i=[],r=[],t="",$(".reforma-desk_base").hasClass("is-hide")&&($(".reforma-desk_base").removeClass("is-hide"),$(".reforma-desk_game").addClass("is-hide")),$(".reforma-game_life").removeClass("is-burn"),$(".js-popup_content-card").empty();var e=$(".reforma-game_info-message"),c=$(".reforma-game_info-action");e.addClass("is-hide"),c.removeClass("is-hide"),$(".reforma_card").remove(),shuffle(a),n()};var n=function(){for(var e=$(".reforma-deck_card"),s=0;s<a.length;s++){var o="";"economics"==a[s].type?o+="Экономика":"social"==a[s].type?o+="Социальная сфера":"war"==a[s].type&&(o+="Военное дело");var r=$('  <div class="reforma_card '+a[s].type+'" id="'+a[s].id+'">    <div class="reforma-card_tag"><span class="reforma-card_icon"></span>'+o+'</div>    <div class="reforma_card-content">\t\t<div class="reforma_card-title">'+a[s].title+'</div>\t\t<div class="reforma_card-text">'+a[s].content+"</div>  \t </div>  </div>");i.push(a[s].id),e.prepend(r)}c()},c=function(){t=$("#"+i[0]),t.addClass("is-active").siblings(".reforma_card").removeClass("is-active")},d=function(){var e=$(".reforma-game_life");o-=1,console.log("qwe",o),1==o&&e.eq(1).addClass("is-burn"),0==o&&(e.eq(0).addClass("is-burn"),p("finish"))},l=function(e){t.removeClass("is-active"),i.splice(0,1),console.log("putOnTable",e);var a=$(".reforma-game_col.is-economy").find(".reforma-game_content"),s=$(".reforma-game_col.is-social").find(".reforma-game_content"),o=$(".reforma-game_col.is-war").find(".reforma-game_content");$(".reforma-desk_game").hasClass("is-hide")&&($(".reforma-desk_game").removeClass("is-hide"),$(".reforma-desk_base").addClass("is-hide")),$("#"+e).hasClass("economics")?a.prepend($("#"+e)):$("#"+e).hasClass("social")?s.prepend($("#"+e)):$("#"+e).hasClass("war")&&o.prepend($("#"+e)),$("#"+e).addClass("on-desk"),r.push(e),0==i.length&&($(".reforma_deck").addClass("is-hide"),p())},f=function(e){0==r.length&&(console.log("first or last?",e),l(e)),"101"==e&&r.forEach(function(a,s,o){switch(a){case"102":h("conflict",e,"102");break;case"103":l(e),h("started-work",e,"103")}}),"102"==e&&r.forEach(function(a,s,o){switch(a){case"101":h("conflict",e,"101");break;case"103":l(e),h("lost-life",e),d()}}),"103"==e&&r.forEach(function(a,s,o){switch(a){case"101":l(e),h("started-work",e,"101");break;case"102":l(e),h("lost-life",e),d()}})},m=function(){var e=$(".reforma_card");e.on("click",function(){h("card-info",this)});var a=$(".js-act-add"),s=$(".js-act-skip"),o=$(".js-act-remove");a.on("click",function(){var e=t.attr("id");f(e),c()}),s.on("click",function(){i.push(i.splice(0,1)[0]),c()}),o.on("click",function(){i.splice(0,1),c(),0==i.length&&(t.removeClass("is-active"),p())})},p=function(e){s>=100&&v("victory"),s<100&&v("loose"),v(popupType)},v=function(e){var a=$(".reforma-game_info-message"),o=$(".reforma-game_info-action");a.removeClass("is-hide").addClass(e),o.addClass("is-hide"),$(".reforma-game_info-message-score").text(s),e==victory&&$(".reforma-game_info-message-title-text").text("Победа!"),$(".js-popup-info-link").on("click",function(){h("finish",e)})},h=function(e,s,o){var i=$(".js-overlay"),t=$(".js-popup"),n=$(".js-popup-close"),d=$(".js-popup_content-card"),f=$(".js-popup-text");if(t.addClass("is-hide"),i.removeClass("is-hide"),$("."+e).removeClass("is-hide"),n.on("click",function(){i.addClass("is-hide"),$("."+e).addClass("is-hide"),d.empty()}),$(document).on("keydown",function(a){27==a.which&&(i.addClass("is-hide"),$("."+e).addClass("is-hide"),d.empty())}),"card-info"==e&&(console.log("this",s),$(s).clone().removeClass("on-desk").attr("id","").prependTo(d)),"conflict"==e&&(console.log("conflict",s,o),f.text(data.messages.contras[0].content),$("#"+s).clone().removeClass("on-desk").addClass("reforma-deck_card").prependTo(d),$("#"+o).clone().removeClass("on-desk").addClass("reforma-deck_card").prependTo(d),$("."+e).find(".reforma_card").on("click",function(){var a=$(this).attr("id"),s=$(this).siblings(".reforma_card").attr("id");cardInd=r.indexOf(s),cardInd>-1&&r.splice(cardInd,1),l(a),$("#"+s).remove(),c(),i.addClass("is-hide"),$("."+e).addClass("is-hide"),d.empty(),console.log("conflictClick",$(this))})),"started-work"==e){var m='<div class="reforma-popup_wrap">    <div class="reforma-popup_par-extra">'+a[0].title+'</div>\t  <div class="reforma-popup_par">'+data.messages.cardactivated[0].content+"</div></div>";d.prepend(m)}if("lost-life"==e){var p='<div class="reforma-popup_wrap">\t  <div class="reforma-popup_par">'+s+"</div></div>";d.prepend(p)}}};$(document).ready(function(){var e=$(".js-reforma-start"),a=new Reforma;a.init(),e.on("click",function(e){e.preventDefault(),a.reset()})});