function shuffle(e){for(var a,s,o=e.length;0!==o;)s=Math.floor(Math.random()*o),o-=1,a=e[o],e[o]=e[s],e[s]=a;return e}var data={deck:[{id:"101",type:"economics",title:"Подушная подать",content:"Обложить налогом мужчин всех сословий, кроме дворянства и духовенства",failMessage:!1},{id:"102",type:"economics",title:"Подворная подать",content:"Собирать налог не с отдельных представителей податных сословий, а с семьи как хозяйствующего субъекта",failMessage:!1},{id:"103",type:"economics",title:"Пропорциональный подоходный налог",content:"Обложить налогом представителей всех сословий без исключения пропорционально их доходам: чем больше доход, тем выше налог",failMessage:{title:"Конфуз вышел, государь!",content:"Все известные попытки введения пропорционального подоходного налога в условиях сословного общества закончились плачевно. В России они, по счастью, вообще не предпринимались вплоть до Первой мировой войны. Что же касается времен Петра I, служилое сословие по традиции рассматривалось как выплачивающее «налог кровью». Церковь, с некоторыми нюансами, была свободна от налогов еще с татаро-монгольских времен. Возложить дополнительное налоговое бремя на богатых купцов означало удушить оживляющуюся внешнюю торговлю и формирующуюся национальную промышленность. Иными словами, введение подоходного налога – слишком решительный шаг в условиях первой четверти XVIII века, который мог закончиться, чем угодно: бунтом, дворянским заговором, но только не победой в Северной войне."}}]},Reforma=function(){var e=this,a=data.deck,s=0,o=2,i=[],r=[],n="";e.init=function(){e.reset(),shuffle(a),c(),console.log("deck1",a[1].title),d(),v();var s=$(".js-act-add"),o=$(".js-act-skip"),r=$(".js-act-remove");s.on("click",function(){var e=n.attr("id");n.removeClass("is-active"),i.splice(0,1),f(e),t()}),o.on("click",function(){i.push(i.splice(0,1)[0]),t()}),r.on("click",function(){i.splice(0,1),t(),0==i.length&&(n.removeClass("is-active"),h())})},e.reset=function(){console.log("reset",1),s=0,o=2,i=[],r=[],n="",$(".reforma-desk_base").hasClass("is-hide")&&($(".reforma-desk_base").removeClass("is-hide"),$(".reforma-desk_game").addClass("is-hide")),$(".reforma-game_life").removeClass("is-burn");var e=$(".reforma-game_info-message"),t=$(".reforma-game_info-action");e.addClass("is-hide"),t.removeClass("is-hide"),$(".reforma_card").remove(),shuffle(a),c()};var c=function(){for(var e=$(".reforma-deck_card"),s=0;s<a.length;s++){var o="";"economics"==a[s].type?o+="Экономика":"social"==a[s].type?o+="Социальная сфера":"war"==a[s].type&&(o+="Военное дело");var r=$('  <div class="reforma_card '+a[s].type+'" id="'+a[s].id+'">    <div class="reforma-card_tag"><span class="reforma-card_icon"></span>'+o+'</div>    <div class="reforma_card-content">\t\t<div class="reforma_card-title">'+a[s].title+'</div>\t\t<div class="reforma_card-text">'+a[s].content+"</div>  \t </div>  </div>");i.push(a[s].id),e.prepend(r)}t()},t=function(){n=$("#"+i[0]),n.addClass("is-active").siblings(".reforma_card").removeClass("is-active")},d=function(){var e=$(".reforma-game_score");e.text(s),100==s&&h(victory)},l=function(){var e=$(".reforma-game_life");o-=1,console.log("qwe",o),1==o&&e.eq(1).addClass("is-burn"),0==o&&(e.eq(0).addClass("is-burn"),h(victory))},f=function(e){var a=$(".reforma-game_col.is-economy").find(".reforma-game_content"),s=$(".reforma-game_col.is-social").find(".reforma-game_content"),o=$(".reforma-game_col.is-war").find(".reforma-game_content");$(".reforma-desk_game").hasClass("is-hide")&&($(".reforma-desk_game").removeClass("is-hide"),$(".reforma-desk_base").addClass("is-hide")),m(e),$("#"+e).hasClass("economics")?a.prepend($("#"+e)):$("#"+e).hasClass("social")?s.prepend($("#"+e)):$("#"+e).hasClass("war")&&o.prepend($("#"+e)),$("#"+e).addClass("on-desk"),r.push(e),0==i.length&&h()},m=function(e){console.log("card-active",e),"101"==e&&r.forEach(function(e,a,s){switch(e){case"102":p("conflict");case"103":p("started-work")}}),"103"==e&&r.forEach(function(e,a,s){switch(e){case"101":p("started-work");case"102":p("lost-life"),l()}})},v=function(){var e=$(".reforma_card");e.on("click",function(){p("card-info",this)})},h=function(e){s>=100&&u("victory"),s<100&&u("loose"),u(e),console.log("end",h)},u=function(e){var a=$(".reforma-game_info-message"),s=$(".reforma-game_info-action");a.removeClass("is-hide").addClass(e),s.addClass("is-hide"),$(".js-popup-info-link").on("click",function(){p("victory")})},p=function(e,a){var s=$(".js-overlay"),o=$(".js-popup"),i=$(".js-popup-close");if(o.addClass("is-hide"),s.removeClass("is-hide"),$("."+e).removeClass("is-hide"),i.on("click",function(){s.addClass("is-hide"),$("."+e).addClass("is-hide"),"card-info"==e&&r.empty()}),$(document).on("keydown",function(a){27==a.which&&(s.addClass("is-hide"),$("."+e).addClass("is-hide"),"card-info"==e&&r.empty())}),"card-info"==e){var r=$(".js-popup_content-card");console.log("this",a),$(a).clone().removeClass("on-desk").attr("id","").prependTo(r)}}};$(document).ready(function(){var e=$(".js-reforma-start"),a=new Reforma;a.init(),e.on("click",function(e){e.preventDefault(),a.reset()})});